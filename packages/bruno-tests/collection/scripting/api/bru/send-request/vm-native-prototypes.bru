meta {
  name: vm-native-prototypes
  type: http
  seq: 2
}

post {
  url: https://echo.usebruno.com
  body: none
  auth: inherit
}

tests {
  await test("sendRequest resolved data has VM-native prototypes (async/await)", async () => {
    const res = await bru.sendRequest({
      url: 'https://echo.usebruno.com',
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      data: JSON.stringify({ hello: "bruno", list: [1, 2] })
    });
    expect(res.data.constructor).to.equal(Object);
    expect(res.data.list.constructor).to.equal(Array);
  });

  await test("sendRequest resolved data has VM-native prototypes (promise chain)", async () => {
    await bru.sendRequest({
      url: 'https://echo.usebruno.com',
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      data: JSON.stringify({ nested: { key: "value" } })
    })
    .then(res => {
      expect(res.data.constructor).to.equal(Object);
      expect(res.data.nested.constructor).to.equal(Object);
    });
  });

  await test("sendRequest resolved data has VM-native prototypes (callback)", async () => {
    await bru.sendRequest({
      url: 'https://echo.usebruno.com',
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      data: JSON.stringify({ items: [{ id: 1 }] })
    }, function(error, response) {
      expect(response.data.constructor).to.equal(Object);
      expect(response.data.items.constructor).to.equal(Array);
      expect(response.data.items[0].constructor).to.equal(Object);
    });
  });
}
